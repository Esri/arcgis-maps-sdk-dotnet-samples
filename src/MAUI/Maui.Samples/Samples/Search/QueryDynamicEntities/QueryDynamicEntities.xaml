<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="ArcGIS.Samples.QueryDynamicEntities.QueryDynamicEntities"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:esriUI="clr-namespace:Esri.ArcGISRuntime.Maui;assembly=Esri.ArcGISRuntime.Maui"
             xmlns:local="clr-namespace:ArcGIS.Samples.QueryDynamicEntities">
    <Grid Style="{DynamicResource EsriSampleContainer}">
        <esriUI:MapView x:Name="MyMapView" Style="{DynamicResource EsriSampleGeoView}" />

        <!--  Query Controls  -->
        <Border x:Name="QueryControlPanel"
                Margin="10"
                Style="{DynamicResource EsriSampleControlPanel}"
                VerticalOptions="Center">
            <Border.HorizontalOptions>
                <OnPlatform x:TypeArguments="LayoutOptions">
                    <On Platform="iOS, Android" Value="Center" />
                    <On Platform="WinUI" Value="End" />
                </OnPlatform>
            </Border.HorizontalOptions>
            <Picker x:Name="QueryDropdown"
                    Title="Select Query"
                    SelectedIndexChanged="OnQuerySelectionChanged"
                    WidthRequest="280" />
        </Border>

        <!--  Query Results Panel  -->
        <Border x:Name="ResultsPanel"
                Margin="10"
                IsVisible="False"
                MaximumHeightRequest="400"
                Style="{DynamicResource EsriSampleControlPanel}"
                VerticalOptions="Center"
                WidthRequest="350">
            <Border.HorizontalOptions>
                <OnPlatform x:TypeArguments="LayoutOptions">
                    <On Platform="iOS, Android" Value="Center" />
                    <On Platform="WinUI" Value="End" />
                </OnPlatform>
            </Border.HorizontalOptions>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Label Grid.Row="0"
                       Margin="0,0,0,8"
                       FontAttributes="Bold"
                       FontSize="16"
                       Text="Query Results" />

                <Label x:Name="ResultsDescription"
                       Grid.Row="1"
                       Margin="0,0,0,8"
                       FontAttributes="Italic"
                       LineBreakMode="WordWrap" />

                <ScrollView Grid.Row="2" VerticalScrollBarVisibility="Always">
                    <CollectionView x:Name="ResultsList"
                                    SelectionChanged="OnResultSelectionChanged"
                                    SelectionMode="Single"
                                    VerticalOptions="Start">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="local:FlightInfo">
                                <Border Margin="2"
                                        Padding="8"
                                        Style="{DynamicResource EsriSampleControlPanel}">
                                    <VerticalStackLayout Spacing="4">
                                        <Label FontAttributes="Bold" Text="{Binding FlightNumber}" />
                                        <VerticalStackLayout x:Name="DetailsPanel"
                                                             Margin="10,5,0,5"
                                                             IsVisible="{Binding IsExpanded}"
                                                             Spacing="2">
                                            <Label FontSize="12">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span FontAttributes="Bold" Text="Aircraft: " />
                                                        <Span Text="{Binding Aircraft}" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                            <Label FontSize="12">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span FontAttributes="Bold" Text="Altitude: " />
                                                        <Span Text="{Binding Altitude}" />
                                                        <Span Text=" ft" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                            <Label FontSize="12">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span FontAttributes="Bold" Text="Speed: " />
                                                        <Span Text="{Binding Speed}" />
                                                        <Span Text=" mph" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                            <Label FontSize="12">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span FontAttributes="Bold" Text="Heading: " />
                                                        <Span Text="{Binding Heading}" />
                                                        <Span Text="°" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                            <Label FontSize="12">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span FontAttributes="Bold" Text="Status: " />
                                                        <Span Text="{Binding Status}" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                            <Label FontSize="12">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span FontAttributes="Bold" Text="Arrival: " />
                                                        <Span Text="{Binding ArrivalAirport}" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </VerticalStackLayout>
                                        <Button Padding="4,1"
                                                Clicked="OnToggleDetails"
                                                CommandParameter="{Binding .}"
                                                CornerRadius="4"
                                                FontSize="10"
                                                HeightRequest="26"
                                                Text="{Binding ToggleButtonText}" />
                                    </VerticalStackLayout>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </ScrollView>

                <Button Grid.Row="3"
                        Margin="0,8,0,0"
                        Padding="12,4"
                        Clicked="OnCloseResults"
                        HorizontalOptions="End"
                        Text="Close" />
            </Grid>
        </Border>

        <!--  Flight Number Input Dialog  -->
        <Border x:Name="FlightNumberDialog"
                Margin="20"
                HorizontalOptions="Center"
                IsVisible="False"
                Style="{DynamicResource EsriSampleControlPanel}"
                VerticalOptions="Center"
                WidthRequest="300">
            <VerticalStackLayout Spacing="8">
                <Label Margin="0,0,0,8" Text="Enter Flight Number" />
                <Entry x:Name="FlightNumberInput"
                       BackgroundColor="White"
                       Completed="OnFlightNumberQuery"
                       TextColor="Black" />
                <Label Margin="0,4,0,0"
                       FontAttributes="Italic"
                       FontSize="11"
                       Text="Example: Flight_1107"
                       TextColor="Gray" />
                <HorizontalStackLayout Margin="0,8,0,0"
                                       HorizontalOptions="End"
                                       Spacing="8">
                    <Button Padding="12,4"
                            Clicked="OnFlightNumberQuery"
                            Text="Query" />
                    <Button Padding="12,4"
                            Clicked="OnFlightNumberCancel"
                            Text="Cancel" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>
    </Grid>
</ContentPage>